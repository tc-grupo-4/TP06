%% LyX 2.2.3 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[spanish]{article}
\usepackage[T1]{fontenc}
\usepackage[latin9]{luainputenc}
\usepackage{geometry}
\geometry{verbose,tmargin=2cm,bmargin=2cm,lmargin=2cm,rmargin=2cm,headheight=2cm,headsep=2cm}
\setlength{\parindent}{0bp}
\usepackage{textcomp}
\usepackage{graphicx}
\usepackage{babel}
\addto\shorthandsspanish{\spanishdeactivate{~<>}}

\begin{document}

\part{Oscilador de Wien}

\section{Introducción}

A lo largo de esta parte, se centrará en realizar un oscilador generador
de onda sinusoidal basado en el puente de \emph{Wien.} Para poder
entender este oscilador, resulta necesario comprender el criterio
de Barkhausen, el cual es imprecindible para realizar el oscilador.

\subsection{Criterio de Barkhausen}

Dado un sistema realimentado negativamente, siendo \emph{A }la ganancia
de lazo abierto y $\beta$ la ganancia de realimentación, entonces
se define $T(s)=A(s)\beta(s)$ como la ganancia de lazo de realimentación.

\begin{figure}[h]
\begin{centering}
\includegraphics{Resources/Realimentado}
\par\end{centering}
\caption{Sistema realimentado}

\end{figure}

De acuerdo con lo desarrollado en el libro \emph{Design With Operational
Amplifiers And Analog Integrated Circuits}\footnote{\emph{A lo largo del capitulo 10.1 durante el desarrolo de Basic Wien-Bridge
Oscillator}}\emph{, }pueden ocurrir 3 posibles situaciónes para la ganancia de
lazo de realimentación \emph{T(s)}:
\begin{enumerate}
\item \emph{T($S_{0}$) < 1} : Lo cual supone una atenuación de la señal
por lo que el sistema resulta estable sin oscilar.
\item \emph{T($S_{0}$) > 1} : Lo cual genera una amplificación de la señal
resultando en un sistema inestable que con el correr del tiempo generará
que el amplificador oscile
\item \emph{T($S_{0}$) = 1} : Esta es considerada una estabilidad neutral
ya que no atenua ni amplifica la señal. Esta es la condición que se
tiene en cuenta para que el criterio funcione.
\end{enumerate}
De acuerdo con lo mencionado en el libro, para que se cumpla la condición
3, es necesario tener un par de polos conjugados sobre el eje $j\omega$.

\subsection{Oscilador de \emph{Wien}}

Dado un circuito como el que se muestra en la Figura \ref{1_1}, se
podrá calcular como se mencionó previamente, la ganancia de lazo de
realimentación. 

\begin{figure}[h]
\begin{centering}
\includegraphics{Resources/CircuitoWien.PNG}
\par\end{centering}
\caption{Circuito de Wien}
\label{1_1}

\end{figure}

Como se menciona en el libro\footnote{Partiendo de la ecuación 10.4 y 10.5 de la pagina 486 del libro}
se llega a la ecuación mencionada a continuación:

\begin{equation}
T(f)=\frac{1+\frac{R_{2}}{R_{1}}}{3+j\left(\frac{f}{f_{0}}-\frac{f_{0}}{f}\right)}\label{eq:1_1}
\end{equation}

\begin{equation}
f_{0}=\frac{1}{2\pi RC}\label{eq:1_1_1}
\end{equation}

Por lo tanto, si se remplaza \emph{f} por la frecuencia $f_{0}$,
se obtiene

\begin{equation}
T\left(f_{0}\right)=\frac{1+\frac{R_{2}}{R_{1}}}{3}\label{eq:1_2}
\end{equation}

Consecuentemente, como se desea cumplir con la condición 3 mencionada
en la sbsección anterior, necesariamente $\frac{R_{2}}{R_{1}}=2$.
Por ende, cuando se cumpla esta condición, resulta evidente que se
generará un puente balanceado a lo largo de la frecuencia $f_{0}$.

\section{Análisis del circuito propuesto}

A lo largo de esta sección nos centraremos en analizar el circuito
propuesto por la cátedra que se puede observar en la Figura \ref{1_3}.

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.7]{Resources/Circuito}
\par\end{centering}
\caption{Circuito de Oscilador propuesto}
\label{1_3}

\end{figure}

Como se puede ver en la figura, el circuito propuesto es bastante
parecido al mencionado en la Figura \ref{1_1}, los componentes adicionales
agregados forman parte de lo que se llama \emph{Automatic Amplitude
Control}\footnote{Control Automático de Ganancia o CAG en español}
(AAC). El AAC, es la etapa del circuito encargada de ajustar el valor
de $\frac{R_{3}}{R_{4}}$ dinámicamente con el objetivo de suplir
las falencias constructivas de los elementos resistivos, que generan
un determinado error en el cociente, para llevarlo al valor esperado
de 2.

\subsection{\emph{Automatic Amplitude Control (AAC)}}

\subsubsection{Transistor JFET-N}

Para poder entender el funcionamiento del AAC, es necesario primero
entender como se comporta un JFET-N, para eso, se puede observar la
Figura \ref{1_4}.

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.5]{\string"Resources/ids VS vds\string".png}
\par\end{centering}
\caption{$I_{DS}$ en función de $V_{DS}$, para valores de VGS entre -3 (V)
(linea negra) y 0.5(V) (linea azul) }
\label{1_4}

\end{figure}

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.4]{\string"Resources/RDS vs VDS 1\string".png}\includegraphics[scale=0.4]{\string"Resources/RDS vs VDS 2\string".png}
\par\end{centering}
\caption{$R_{DS}$en función de $V_{DS}$ para valores de $V_{GS}$ entre -2.5(V)
(linea negra) y 0.5(V) (linea verde)}
\label{1_5}

\end{figure}

Como se pudo observar en la Figura \ref{1_5}, se pude utilizar al
transisto JFET-N como resistencia variable, esto es altamente útil
para ajustar el valor del cociente $\frac{R_{3}}{R_{4}}$ visto anteriormente
y utilizarlo a nuestro favor.

\subsubsection{Diodos en serie\label{subsec:Diodos-en-serie}}

Debido a que el oscilador de wien debe poder funcionar sin señal de
entrada, se debe crear un control sobre $\frac{R_{3}}{R_{4}}$ de
modo tal que, cuando el circuito se alimente, rapidamente se llegue
a la oscilación. Esto se realiza mediante el cambo dinamico de $R_{4}$,
es decir, cuando el circuito permanezca apagado, y durante los primeros
instantes de alimentación, $R_{4}$ debe permanecer lo suficientemente
baja poara que el cociente sea lo suficientemente mayor a 2 para lograr
un tiempo de establecimiento relativamente corto, sin embargo, una
vez que se llega a ese tiempo de establecimiento, se debe procurar
de aumentar el valor de $R_{4}$ de modo tal que el cociente de resistencias
sea 2, como fue explicado anteriormente. Para lograr esto, entran
en juego los diodos, que cuando la tensión Vo es lo suficientemente
chica, los diodos no conduzcan, generando asi que el JFET tenga una
resistencia interna aproximadamente igual a 0, y cuando Vo supera
la tensión de umbral de los diodos (aproximadamente 5.4(V)), estos
conduzcan corriente, cargen el capacitor C3 y ajusten la resistencia
interna del transistor $R_{T}$ para que $\frac{R_{3}}{R_{4}+R_{T}}<2$.

\subsubsection{Controlador de respuesta en frecuencia de los diodos}

Debido al comportamiento no lineal de los diodos, como se puede ver
en la Figura \ref{1_6}, el cambio abrupto en la tensión de \emph{Gate}
se deberá controlar para que las componentes de alta frecuencia de
ese comportamiento producido por los diodos.

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.5]{Resources/Diodo}
\par\end{centering}
\caption{Curva de un diodo}
\label{1_6}

\end{figure}

Para resolver este problema de altas frecuencias generadas por los
cambios abruptos, simplemente se añade al circuito un filtro pasivo
de primer orden con comportamiento de pasabajos. Este filtro se logra
con los componentes $C_{3}$ y $R_{x}$, dado que el pasabajos tendrá
una constante de tiempo de establecimiento de $\tau=C_{3}R_{x}$,
estos componentes limitarán el comportamiendo indeseado de los diodos
y mantendran la tensión de gate con pocas variaciones,esto es debido
a la necesidad de controlar muy precisamente la resistencia $R_{DS}$
del transistor. En principio, llamando $f_{0}$ a la frecuencia de
oscilación del oscilador de \emph{Wien }a realizar, se propone que
se cumpla la siguiente inecuación:

\begin{equation}
\frac{1}{f_{0}}<5C_{3}R_{x}\label{eq:1_3}
\end{equation}

\subsubsection{Controlador de amplitud de oscilación}

Como uno bien se puede imaginar en la subsección \ref{subsec:Diodos-en-serie},
la tensión de umbral entre los diodos determina la tensión máxima
de oscilación del circuito, es decir, para una tensión mayor a la
tensión umbral de ambos diodos, la salida de la sinusoidal se verá
recortada por ese tope de tensión. Para esto, la solución mas intuitiva,
es agregar una caida de tensión variable entre los nodos de los diodos,
para ello, lo unico que se debe hacer es conecta una resistencia variable
en serie con los diodos que genere una caida de tensión variable,
y asi, se podría ajustar el valor máximo de la tension pico de la
señal.

Otra manera un poco mas sofisticada de enfrentar este problema es
agregar un circuito inversor\footnote{Se podría utilizar un circuito no inversor, pero no se lo menciona
ya que no presenta ventajas frente a la resistencia en serie con los
diodos} a la salida del oscilador\footnote{Este método queda a discreción de el presupuesto destinado a realizar
el oscilador.}. La ventaja que se obtiene es que, a diferencia del metodo anterior
donde solo se podia aumentar la tensión máxima de salida, en este
caso, se puede controlar, tanto aumentando la tensión maxima de salida
como atenuandola. El hecho de que invierta la señal no sería un problema
ya que al ser un oscilador la fase de 0\textdegree{} uno la define
donde quiere, por lo tanto, se puede interpretar a la salida con un
defasaje de 0\textdegree . Sin embargo, la gran desventaja de esta
solución es el presupuesto de construcción del mismo, ya que se deben
agregar tanto mas componentes pasivos como activos, y el consumo de
corriente del circuito resultante tambien aumentará debido a la alimentacion
del segundo amplificador. 

Estos dos metodos fueron simulados y los resultados se ven en la Figura
\ref{1_7}.

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.5]{\string"Resources/Controlador de amplitud de oscilación\string".png}
\par\end{centering}
\caption{Cambios en el comportamiendo del circuito para diferentes controladores
de amplitud de oscilación}
\label{1_7}

\end{figure}

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.5]{\string"Resources/Circuito Controlador de amplitud por res\string".png}
\par\end{centering}
\caption{Circuito con controlador de amplitud por resistencia}

\end{figure}

\begin{figure}[h]
\begin{centering}
\includegraphics[scale=0.5]{\string"Resources/Circuito Controlador de amplitud por inv\string".png}
\par\end{centering}
\caption{Circuito con controlador de amplitud por etapa inversora}

\end{figure}

\subsection{Máxima frecuencia de oscilación}

Si bien como se ha visto en el análisis anterior, en ningun momento
aparece un limite en la frecuencia de oscilación, esto se debe a que
se trabajó con amplificadores operacionales ideales. Cuando se realiza
el análisis con amplificadores operacionales reales, los limites comienzan
a quedar determinados por el \emph{Gain Bandwidth Product} y el \emph{Slew
Rate. }Al simular el circuito con amplificadores reales, como con
el LM833 o el TL082, se observó que el limite de frecuencias a las
cuales el oscilador dejaba de funcionar dependía del tiempo de establecimiento
que estuvieramos dispuestos a esperar. Es por eso que para tiempos
de establecimiento relativamente razonables, en las simuaciones quedó
en evidencia que que las frecuencias disponibles para realizar el
oscilador no podian superar los 500(kHz).

\subsection{Análisis de sensibilidades}

Se propone calcular analíticamente las sensibilidades del circuito
respecto de los componentes de lazo de realimentación positiva. Para
esto, primero que nada, es necesario calcular la funcion de la realimentación
positiva. Por lo tanto, a continuación se procederá a calcular la
ganancia de realimentación positiva del circuito\footnote{Si bien se podría utilizar la ecuación 10.5 sacada de la pagina 486
del libro, esto no se debe hacer, debido a que en el libro se considera
que $C_{2}$ y $C_{1}$ son iguales, y $R_{2}$ y $R_{1}$ también,
y para el calculo de sensibilidades es necesario considerarlos como
2 componentes distintos.}. Para esto, observando la Figura \ref{1_3}, se plantea por el nodo
$V_{p}$ la siguiente ecuación

\[
\frac{V_{p}-V_{o}}{\frac{1}{sC_{1}}+R_{1}}=-V_{p}\left(sC_{2}+\frac{1}{R_{2}}\right)^{-1}
\]

\begin{equation}
\Rightarrow\beta(s)=\frac{V_{p}}{V_{o}}=\frac{sC_{1}R_{2}}{s^{2}C_{1}C_{2}R_{1}R_{2}+s\left(C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}\right)+1}\label{eq:1_4}
\end{equation}

A partir de la ganancia de realimentación positiva de nuestro circuito
calculada en la ecuación \ref{eq:1_4}, de esta manera, operando adecuadamente
con la ganancia del circuito no inversor $(A=1+\frac{R_{3}}{R_{4}})$,
la transferencia de la ecuación \ref{eq:1_2} queda reescrita de la
siguiente manera:

\[
T(s)=\frac{sC_{1}R_{2}\left(1+\frac{R_{3}}{R_{4}}\right)}{s^{2}C_{1}C_{2}R_{1}R_{2}+s\left(C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}\right)+1}
\]

Por último, las ecuaciónes de $\omega_{0}$ y \emph{Q }quedan definidas
por:

\[
\omega_{0}=\sqrt{\frac{1}{C_{2}R_{2}C_{1}R_{1}}}
\]

\[
Q=\frac{\sqrt{C_{1}C_{2}R_{1}R_{2}}}{C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}}
\]

De esta manera las sensibilidades quedaran definidas por la formula
\ref{eq:1_5}, y calculando respectivamente cada una de ellas los
resultados son los que se muestran en las ecuaciones posteriores.

\begin{equation}
S_{x_{k}}^{f(\bar{X})}=\left.\frac{\partial f(\bar{X})}{\partial x_{k}}\frac{x_{k}}{f(\bar{X})}\right|_{\bar{X}=\bar{X}_{0}}\label{eq:1_5}
\end{equation}

$S_{C_{1}}^{\omega_{0}}=S_{C_{2}}^{\omega_{0}}=S_{R_{1}}^{\omega_{0}}=S_{R_{2}}^{\omega_{0}}=-\frac{1}{2}$

$S_{C_{1}}^{Q}=-\frac{1}{2}\frac{3C_{1}R_{1}+3C_{1}R_{2}+C_{2}R_{2}}{C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}}$

$S_{C_{2}}^{Q}=-\frac{1}{2}\frac{C_{1}R_{1}+C_{1}R_{2}+3C_{2}R_{2}}{C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}}$

$S_{R_{1}}^{Q}=-\frac{1}{2}\frac{3C_{1}R_{1}+3CR_{2}+C_{2}R_{2}}{C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}}$

$S_{R_{2}}^{Q}=-\frac{1}{2}\frac{C_{1}R_{1}+3C_{1}R_{2}+3C_{2}R_{2}}{C_{1}R_{1}+C_{1}R_{2}+C_{2}R_{2}}$

Si se reemplaza por los valores tal que $C_{1}=C_{2}=C$ y $R_{1}=R_{2}=R$,
entonces los valores de las sensibilidades quedaran como:

\[
S_{C}^{\omega_{0}}=S_{R}^{\omega_{0}}=1
\]

\[
S_{C}^{Q}=S_{R}^{Q}=0
\]

\section{Implementación}

A lo largo de esta sección nos centraremos en desarrollar el proceso
de implementación del circuito analizado anteriormente. Como primera
etapa, nos centraremos en analizar los componentes que fijan la frecuencia
de oscilación, que es lo primordial en nuestro diseño.

\subsection{Frecuencia de oscilación}

Como se puede observar en la ecuación \ref{eq:1_1_1}, si se toman
valores iguales de $R_{1}=R_{2}=R$ y $C_{1}=C_{2}=C$, entonces con
fijar un valor arbitrariamente, el valor del otro componente quedará
determinado por ese valor, y la frecuencia de operación de nuestro
oscilador. Como nuestra frecuencia de oscilación es de $f_{0}=70\left(kHz\right)$,
fijando el valor del capacitor a un valor comercial conocido, como
$C=10\left(nF\right)$\footnote{Se utilizó este valor para usar los mismos valores que los capacitores
de desacople y obtener un solo valor de capacitor en todo el PCB}, la resistencia por lo tanto quedara fijada y de valor $R=227.36\left(\Omega\right)$.
Debido al hecho de que ese valor de resistencia no es un valor comercial,
se decidió aproximar ese valor al valor comercial más cercano, sea
$R=220(\Omega)$, resultando en un error relativo de resistencia de
$Error\approx3\%$. De esta manera la frecuencia de operación resultante
queda de valor:

\[
f_{0}=72.3\left(kHz\right)
\]

\[
Error\,Relativo=3.34\%
\]


\end{document}
